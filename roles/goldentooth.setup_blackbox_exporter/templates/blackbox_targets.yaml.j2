---
# Prometheus service discovery targets for Blackbox Exporter
# Generated by Ansible - Do not edit manually

# Internal HTTPS services (using Step-CA certificate validation)
{% for service in blackbox_https_internal_targets %}
- targets:
    - "{{ service }}"
  labels:
    job: 'blackbox-https-internal'
    __param_target: "{{ service }}"
{% endfor %}

# Internal HTTP services
{% for service in blackbox_http_targets %}
- targets:
    - "{{ service }}"
  labels:
    job: 'blackbox-http'
    __param_target: "{{ service }}"
{% endfor %}

# External HTTPS services (using public CAs)
{% for service in blackbox_https_external_targets %}
- targets:
    - "{{ service }}"
  labels:
    job: 'blackbox-https-external'
    __param_target: "{{ service }}"
{% endfor %}

# TCP connectivity checks
{% for service in blackbox_tcp_targets %}
- targets:
    - "{{ service }}"
  labels:
    job: 'blackbox-tcp'
    __param_target: "{{ service }}"
{% endfor %}

# DNS resolution checks
{% for domain in blackbox_dns_targets %}
- targets:
    - "{{ domain }}"
  labels:
    job: 'blackbox-dns'
    __param_target: "{{ domain }}"
{% endfor %}

# Node ICMP ping checks
{% for host in groups['all'] %}
- targets:
    - "{{ hostvars[host]['ipv4_address'] }}"
  labels:
    job: 'blackbox-icmp'
    __param_target: "{{ hostvars[host]['ipv4_address'] }}"
    node: "{{ host }}"
{% endfor %}

# Authenticated HTTP endpoints
{% for service in blackbox_http_auth_targets %}
- targets:
    - "{{ service }}"
  labels:
    job: 'blackbox-http-auth'
    __param_target: "{{ service }}"
{% endfor %}

# API endpoints with JSON validation
{% for api in blackbox_api_targets %}
- targets:
    - "{{ api }}"
  labels:
    job: 'blackbox-api'
    __param_target: "{{ api }}"
{% endfor %}

# Certificate expiry monitoring
{% for cert in blackbox_cert_targets %}
- targets:
    - "{{ cert }}"
  labels:
    job: 'blackbox-cert'
    __param_target: "{{ cert }}"
{% endfor %}

# SSH banner checks
{% for ssh in blackbox_ssh_targets %}
- targets:
    - "{{ ssh }}"
  labels:
    job: 'blackbox-ssh'
    __param_target: "{{ ssh }}"
{% endfor %}

# Kubernetes API health checks
{% for k8s in blackbox_k8s_targets %}
- targets:
    - "{{ k8s }}"
  labels:
    job: 'blackbox-k8s'
    __param_target: "{{ k8s }}"
{% endfor %}