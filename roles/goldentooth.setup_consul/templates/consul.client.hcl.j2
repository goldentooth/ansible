datacenter = "{{ consul_datacenter }}"
domain = "{{ consul_domain }}"
data_dir = "{{ consul_data_path }}"
encrypt = "{{ gossip_key.stdout }}"
retry_join = {{ groups['consul_server'] | map('extract', hostvars, 'ipv4_address') | ansible.builtin.to_json }}
bind_addr = "{{ ipv4_address }}"

tls {
  defaults {
    ca_file = "{{ consul_agent_ca_path }}"
    verify_incoming = true
    verify_outgoing = true
  }
  internal_rpc {
    verify_server_hostname = true
  }
}

encrypt = "{{ gossip_key.stdout }}"

auto_encrypt {
  tls = true
}

acl {
  enabled = true
  default_policy = "allow"
  enable_token_persistence = true
}

telemetry {
  enable_host_metrics = true
  prometheus_retention_time = "60s"
  disable_hostname = true
}
