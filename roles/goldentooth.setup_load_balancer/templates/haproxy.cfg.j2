global
  user haproxy
  group haproxy
  daemon
  maxconn 4096
defaults
  timeout connect 10s
  timeout client 86400s
  timeout server 86400s
  balance roundrobin
  log global
  mode tcp
  maxconn 2000
frontend k8s-api-server
  bind {{ ipv4_address }}:9000
  mode tcp
  option tcplog
  default_backend k8s-api-server
backend k8s-api-server
  mode tcp
  balance roundrobin
  option tcp-check
{% for host in groups['control_plane'] %}
  server {{ host }} {{ hostvars[host]['ansible_default_ipv4']['address'] }}:6443 check fall 3 rise 2
{% endfor %}
