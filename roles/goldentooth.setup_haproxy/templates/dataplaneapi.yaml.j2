# HAProxy DataPlane API Configuration
# Generated by Ansible - Do not edit manually

config_version: 2
name: goldentooth-haproxy

dataplaneapi:
  host: 0.0.0.0
  port: 5555
  scheme:
    - http
  
  # User authentication
  user:
    - name: {{ my.name.lower }}
      password: {{ secret_vault.easy_password }}

haproxy:
  config_file: /etc/haproxy/haproxy.cfg
  haproxy_bin: /usr/sbin/haproxy
  
  # Reload configuration section
  reload:
    reload_strategy: systemd
    reload_cmd: systemctl reload haproxy
    restart_cmd: systemctl restart haproxy
    reload_delay: 5
  
  # Runtime API socket
  runtime_apis:
    - /var/run/haproxy/admin.sock

# Transaction settings
transaction:
  transaction_dir: /tmp/haproxy

# Service Discovery Configuration
service_discovery:
  consuls:
    - address: 127.0.0.1:8500
      enabled: true
      id: goldentooth-consul
      name: goldentooth-consul
      retry_timeout: 10
      server_slots_base: 10
      server_slots_growth_type: "exponential"
      server_slots_increment: 5
      
      # Service to backend mappings
      services:
        - name: grafana
          backend_name: consul-grafana
          mode: http
          balance: roundrobin
          check: enabled
          check_ssl: enabled
          check_path: /api/health
          ssl: enabled
          ssl_verify: none
          
        - name: prometheus  
          backend_name: consul-prometheus
          mode: http
          balance: roundrobin
          check: enabled
          check_path: /-/healthy
          
        - name: loki
          backend_name: consul-loki
          mode: http
          balance: roundrobin
          check: enabled
          check_ssl: enabled
          check_path: /ready
          ssl: enabled
          ssl_verify: none
          
        - name: mcp-server
          backend_name: consul-mcp-server
          mode: http
          balance: roundrobin
          check: enabled
          check_path: /health