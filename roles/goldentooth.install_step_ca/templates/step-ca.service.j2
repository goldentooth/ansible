[Unit]
Description=step-ca
Documentation=https://smallstep.com/docs/step-ca
Documentation=https://smallstep.com/docs/step-ca/certificate-authority-server-production
After=network-online.target
Wants=network-online.target
StartLimitIntervalSec=30
StartLimitBurst=3
ConditionFileNotEmpty={{ step_ca.ca_config_path }}
ConditionFileNotEmpty={{ step_ca.intermediate_password_path }}

[Service]
Type=simple
User={{ step_ca.user }}
Group={{ step_ca.user }}
Environment=STEPPATH={{ step_ca.etc_path }}
WorkingDirectory={{ step_ca.etc_path }}
ExecStart={{ step_ca.ca_executable }} {{ step_ca.ca_config_path }} --password-file {{ step_ca.intermediate_password_path }}
ExecReload=/bin/kill --signal HUP $MAINPID
Restart=on-failure
RestartSec=5
TimeoutStopSec=30
StartLimitInterval=30
StartLimitBurst=10

; Process capabilities & privileges
AmbientCapabilities=CAP_NET_BIND_SERVICE
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
SecureBits=keep-caps
NoNewPrivileges=yes

[Install]
WantedBy=multi-user.target
